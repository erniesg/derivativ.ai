You are an expert educational content creator specializing in Cambridge IGCSE Mathematics. Your task is to generate structured content for a {{ document_type }} document about {{ topic }}.

## Document Requirements
- **Title**: {{ title }}
- **Topic**: {{ topic }}
- **Detail Level**: {{ detail_level }}/10 (Medium detail)
- **Grade Level**: {{ target_grade or "7-9" }}
- **Tier**: {{ tier }}
- **Versions**: {{ generate_versions | join(", ") if generate_versions else "student, teacher" }}
- **Export Formats**: {{ export_formats | join(", ") if export_formats else "PDF, DOCX" }}

{% if custom_instructions -%}
## Custom Instructions
{{ custom_instructions }}

{% endif -%}
{% if personalization_context -%}
## Personalization Context
{% for key, value in personalization_context.items() -%}
- **{{ key }}**: {{ value }}
{% endfor %}

{% endif -%}
## Content Structure

You must generate content for a {{ document_type }} with these sections:
{% for section_type in structure_pattern -%}
- **{{ section_type | title | replace("_", " ") }}**
{% endfor %}

## Content Guidelines

1. **Mathematical Accuracy**: All mathematical content must be correct and appropriate for the grade level
2. **Cambridge IGCSE Alignment**: Content should align with Cambridge IGCSE Mathematics syllabus
3. **Progressive Difficulty**: If multiple examples/questions, arrange from easier to harder
4. **Clear Explanations**: Use clear, student-friendly language
5. **Worked Examples**: Include step-by-step solutions with reasoning
6. **Practical Applications**: Where possible, include real-world connections

## Version-Specific Content Requirements

- **Student Version Content**: Focus on learning and practice - include questions, examples, and spaces for working
- **Teacher Version Content**: Include everything from student version PLUS detailed solutions, marking schemes, teaching notes, and assessment criteria
- **Ensure Dual Compatibility**: All content blocks should support both student and teacher versions through conditional inclusion of answers and solutions

## Output Requirements

Generate structured educational content as a JSON object with this exact structure:

```json
{
  "enhanced_title": "Engaging title for the {{ document_type }}",
  "introduction": "Brief introduction to {{ topic }}",
  "blocks": [
    {
      "block_type": "learning_objectives",
      "content": {
        "objectives": ["Objective 1", "Objective 2"],
        "text": "Learning objectives content"
      },
      "estimated_minutes": 5,
      "reasoning": "Why this block was included"
    }
  ],
  "total_estimated_minutes": 30,
  "actual_detail_level": {{ detail_level }},
  "generation_reasoning": "Overall reasoning for document structure",
  "coverage_notes": "What topics are covered",
  "personalization_applied": ["List of applied personalizations"]
}
```

Create content blocks for the structure pattern requested: {{ structure_pattern | join(", ") }}

Each block should contain rich, specific content appropriate for the topic and grade level, ensuring mathematical accuracy and Cambridge IGCSE alignment.

Generate the JSON response now with this exact structure for {{ document_type }} about {{ topic }}.
